<?xml version="1.0" encoding="utf-8"?>

<UserControl
  x:Class="FalloutXbox360Utils.WorldMapControl"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:canvas="using:Microsoft.Graphics.Canvas.UI.Xaml">

  <Grid>
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto" />
      <RowDefinition Height="*" />
      <RowDefinition Height="Auto" />
    </Grid.RowDefinitions>

    <!-- Toolbar -->
    <StackPanel Grid.Row="0" Orientation="Horizontal" Spacing="8" Padding="0,0,0,8">
      <Button x:Name="BackButton" Click="BackButton_Click"
              Visibility="Collapsed" ToolTipService.ToolTip="Back to World Map">
        <FontIcon Glyph="&#xE72B;" FontSize="12" />
      </Button>
      <ComboBox x:Name="WorldspaceComboBox" MinWidth="220"
                SelectionChanged="WorldspaceComboBox_SelectionChanged"
                PlaceholderText="Select Worldspace" />
      <Button Content="Fit" Click="ZoomFit_Click"
              ToolTipService.ToolTip="Zoom to fit" />
      <TextBlock x:Name="ZoomLevelText" VerticalAlignment="Center" FontSize="11"
                 Foreground="{ThemeResource TextFillColorSecondaryBrush}" />

      <!-- Legend toggle -->
      <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
              CornerRadius="4" Padding="8,2" VerticalAlignment="Center">
        <StackPanel Orientation="Horizontal" Spacing="12">
          <StackPanel Orientation="Horizontal" Spacing="4">
            <Border Width="10" Height="10" CornerRadius="2"
                    Background="#A0A0A0" />
            <TextBlock Text="Static" FontSize="10" VerticalAlignment="Center" />
          </StackPanel>
          <StackPanel Orientation="Horizontal" Spacing="4">
            <Border Width="10" Height="10" CornerRadius="2"
                    Background="#3C8C28" />
            <TextBlock Text="Plant" FontSize="10" VerticalAlignment="Center" />
          </StackPanel>
          <StackPanel Orientation="Horizontal" Spacing="4">
            <Border Width="10" Height="10" CornerRadius="2"
                    Background="#FFA500" />
            <TextBlock Text="Door" FontSize="10" VerticalAlignment="Center" />
          </StackPanel>
          <StackPanel Orientation="Horizontal" Spacing="4">
            <Border Width="10" Height="10" CornerRadius="2"
                    Background="#00C8C8" />
            <TextBlock Text="Activator" FontSize="10" VerticalAlignment="Center" />
          </StackPanel>
          <StackPanel Orientation="Horizontal" Spacing="4">
            <Border Width="10" Height="10" CornerRadius="2"
                    Background="#00C800" />
            <TextBlock Text="NPC" FontSize="10" VerticalAlignment="Center" />
          </StackPanel>
          <StackPanel Orientation="Horizontal" Spacing="4">
            <Border Width="10" Height="10" CornerRadius="2"
                    Background="#DC3232" />
            <TextBlock Text="Creature" FontSize="10" VerticalAlignment="Center" />
          </StackPanel>
          <StackPanel Orientation="Horizontal" Spacing="4">
            <Border Width="10" Height="10" CornerRadius="5"
                    Background="#FFFFFF" />
            <TextBlock Text="Marker" FontSize="10" VerticalAlignment="Center" />
          </StackPanel>
        </StackPanel>
      </Border>
    </StackPanel>

    <!-- Win2D Canvas -->
    <canvas:CanvasControl x:Name="MapCanvas" Grid.Row="1"
                          Draw="MapCanvas_Draw"
                          PointerPressed="MapCanvas_PointerPressed"
                          PointerMoved="MapCanvas_PointerMoved"
                          PointerReleased="MapCanvas_PointerReleased"
                          PointerWheelChanged="MapCanvas_PointerWheelChanged" />

    <!-- Cell Browser (shown instead of canvas when "All Cells" or "Interiors" is selected) -->
    <Grid x:Name="CellBrowserPanel" Grid.Row="1" Visibility="Collapsed">
      <Grid.RowDefinitions>
        <RowDefinition Height="Auto" />
        <RowDefinition Height="*" />
        <RowDefinition Height="Auto" />
      </Grid.RowDefinitions>
      <TextBox x:Name="CellSearchBox" Grid.Row="0" PlaceholderText="Search cells..."
               TextChanged="CellSearchBox_TextChanged" Margin="0,0,0,4" />
      <ListView x:Name="CellListView" Grid.Row="1"
                SelectionMode="Single"
                SelectionChanged="CellListView_SelectionChanged">
        <ListView.GroupStyle>
          <GroupStyle>
            <GroupStyle.HeaderTemplate>
              <DataTemplate>
                <TextBlock Text="{Binding Key}" FontSize="13" FontWeight="Bold"
                           Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
              </DataTemplate>
            </GroupStyle.HeaderTemplate>
          </GroupStyle>
        </ListView.GroupStyle>
        <ListView.ItemTemplate>
          <DataTemplate>
            <Grid Padding="4,2" ColumnSpacing="12">
              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="70" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
              </Grid.ColumnDefinitions>
              <TextBlock Grid.Column="0" FontSize="11" FontFamily="Consolas"
                         Text="{Binding GridLabel}" />
              <TextBlock Grid.Column="1" FontSize="11"
                         Text="{Binding DisplayName}" TextTrimming="CharacterEllipsis" />
              <TextBlock Grid.Column="2" FontSize="11" FontFamily="Consolas"
                         Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                         Text="{Binding ObjectCount}" />
            </Grid>
          </DataTemplate>
        </ListView.ItemTemplate>
      </ListView>
      <Button x:Name="ViewCellButton" Grid.Row="2" Content="View Cell"
              Click="ViewCellButton_Click" Visibility="Collapsed"
              Margin="0,4,0,0"
              ToolTipService.ToolTip="View this cell in detail mode" />
    </Grid>

    <!-- Status bar -->
    <Grid Grid.Row="2" Padding="0,4,0,0">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="*" />
        <ColumnDefinition Width="Auto" />
      </Grid.ColumnDefinitions>
      <TextBlock x:Name="HoverInfoText" Grid.Column="0" FontSize="11"
                 Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
      <TextBlock x:Name="CoordsText" Grid.Column="1" FontSize="11" FontFamily="Consolas"
                 Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
    </Grid>
  </Grid>
</UserControl>
